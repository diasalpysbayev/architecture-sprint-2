[Схема](https://viewer.diagrams.net/?tags=%7B%7D&lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1#R%3Cmxfile%3E%3Cdiagram%20name%3D%22Page-1%22%20id%3D%22sbHsY8bsidqXC6nebzc5%22%3EtZXfc5QwEMf%2FGh7rHNDD9tH7YfvQqjPnaNsXJyVriAaWyS0F%2FOsNx3IBsZ6d0Sf2%2B81myX4SQhCv8%2BbKijK7RQkmiBayCeJNEEVhdB65R%2Be0vXMRJb2hrJac5I2d%2FgFsLtittIT9JJEQDelyaqZYFJDSxBPWYj1N%2B4pm%2BtZSKJgZu1SYuftZS8qGLl57%2Fxq0yoY3h8llP5KLIZk72WdCYj2y4m0Qry0i9VHerMF08AYu%2Fby3z4weF2ahoL%2BZsEse3nx5l6pPpvlYLc%2BTa7xPzrjKkzAVN3yLhcLNitdM7QDCLb%2FswrQ1upBg4yBe1Zkm2JUi7QZqdwCcl1FunApd%2BIiVy5Q3j0dDpN%2BV7dz3FbkywP6%2B3%2FZw6eJ5W8MawRI0I4vbvALMgWzrUnh0mTByPnPRBeva7%2BCQko02b0gTfGbUsbLH6gIm%2BwLK0Yxy2eYd5zNR6hlp22NjNicY%2FwNc8a%2B4Lue4wug3vJL%2FxSueMQHpvkqWaClDhYUwW%2B%2BuPLWFUz7nBrFkVt%2BAqOUrRlSEU5LQaLobxfddqVdLVpuGKx9EO4jCtXs3FqNZnfTTDmoy7wNY7XiBZfPZrdxjZVM4fb5IWAV0%2BmvvYP7xYFgwgvTT9Ap8wS476e%2B1w9jo7xBvfwI%3D%3C%2Fdiagram%3E%3Cdiagram%20name%3D%22Page-2%22%20id%3D%22foUYBzVavApCEgFbdAGA%22%3E7VZNj5swEP01HLeK7ZCPaz66e9hVK%2BXQ9OiFWXBrMHKGBfrra8IQoKhJ2111U6kSEp7n8Yw9b57BE%2BukvLUyix9MCNrjk7D0xMbjnM3nU%2FeqkYoQtmANElkVEtYBO%2FUNCJwQmqsQDgNHNEajyoZgYNIUAhxg0lpTDN2ejB5mzWQEI2AXSD1GP6kQ4wZd8HmH34GK4jYzmy2bmUS2znSSQyxDU%2FQgsfX4zOOilJ5YeTU2fMTaGoMX3VrnpFyDrqvf1rXJ%2B%2F7PA5zObiHFV4qJbM%2B44ckdj5Yay0P2tN3fUKJnqXMq%2B4NJI7NZUeWwaulwRczqYVBplYZghUtfxAphl8mgnihcHzosxkQ7i7nho8mdZ3j%2FeAJk8DWyNfohRxcGCD80zcf845GOGwKLUP60GOxXWPyxHrdgEkBbOZsi%2B3PqENIIn5BddA03Iyju9dqCMEktHp0i%2FxZFzpdYel1S%2FRF5EDppkWksxiYyqdTbDl3Zhis37%2FKsOp97YzJi6QsgVnRPyBzNkOwmZ53oPGtuXya3AZzZP6fbRtoI8Izf9IVdYEFLVM%2FDDV8pp3wk1KxKaqneyEyN%2BO7YZJdl%2BjcVJ1o5tYpbjhXH2nu7L7l23ZXSI95CclAq3PfGn%2BtQ73yyNiVFPhpVa6SuaPu%2B0VtVm92yozVY9xGsclUHS%2BAbaP6lffgvaX76%2F%2BPcuyqEf6Uf56PvhR9Gitf7Vxfb7w%3D%3D%3C%2Fdiagram%3E%3Cdiagram%20name%3D%22Page-3%22%20id%3D%22Qx7-Q9_MMuGqKBw65pJE%22%3E7VvbctowEP0aPyaD7%2FAYIE2nTdpMecjlpaNgxVZrLI%2BQA%2B7XV7IlfBEFJ4ECdmYyQ3Yla6U9q7NaGTRzNFteERAHN9iDoWb0vKVmjjXD0A3LYB9ck%2BaavuHmCp8gT3QqFBP0BwplT2gT5MF5pSPFOKQoriqnOIrglFZ0gBC8qHZ7xmHVagx8qCgmUxCq2jvk0aC2Cq7%2FDJEfSMu6M8hbZkB2FiuZB8DDi5LKvNQMRzPMJdDMocZ11T9zRDCmW7vJzrPlCIbc%2BdKvud1Pbx9gtXYCI7qjMe8YfF%2FvbqMv365%2BhsHjo3s%2Fn5wJQ3OaSrdDj6EgRExogH0cgfCy0A4JTiIP8lGZnWHR5xrjmCl1pvwFKU1FSIGEYqYK6CwUrWxNJL0Xz2fCAxfObSmOl%2BXGcSqkfK58gv%2F0klwPTsgUbli32BsUEB%2FSDf3cJuFSd%2FwVxDPIJs5kAkNA0Ut1wkDsDH%2FV71XIsr4C3N3GgvDJCwgTMd84neHIx2cgRkqcFFHAIV0EiMJJDDKnLxghVREXI0NC4XIzdu%2FwtRxZ7HpBe8ZAyIuCRHTJDEGJQJzeUaNjKuiMcPSM%2FISwAMMRa5pAwjx8QkC5VaRW8okjZR2WUwsafSi37Z9T3YacanaIU%2B2O5temsdDvUCw4H7GwMRZ0p0PB4Crp%2FAdO6Cmn77YctPoKMqeDiW3WjlQ9FRPDWoPJsYMyUEC54ZXJeKhgw4r9mP87TUPEQCLmdoSecjivn1YKMP3tZyB%2FTygbBgr9PGdZ3f7PsDpGDVZbhdVZg2r%2FuEGVlVoJ1UkAiJcNY6pXE8zTtIocCJEfcbCZxxl3mkOOB5qC8EI0zJDnZYl0XQhUk%2BtBAdWbAWoeOaAHvk46t4xK8VMca9YfcjLpFhLEnMjDJ1cuES0VUkx6KLUUI3FhD6el%2FkcVpcaVejXVJfq3JRXIk1ZL6F%2B90uoSqk6%2Fnage9vprJTQrc9dmgB2y%2BaAhm%2BcM1xU6P6lbsaMJkU5lfEfJDUrMnEwVbrWlCtfVW6tOZWyjhmtLMrZ641Uqw9V9194y3GpJGd7t27J6uWS3Y5vKWO0oqvVyqS2oHvbK7MjKJb3xu8JBhw7Da86%2BHa6XGsdITphdiRH1Mk0Nmsi74F%2FMZVKEOaGX4V53CtuO1zu8W%2BJtSeVl3pa6xiC8ZirFhG4xYgtaZZm%2BLNVklpFZV1rMw1M89Qrkt9h17KrdetbKg%2F29Zhn6IC2NGvPx5m9zXmMXiqW8bcbsuXzSrwu0bJetYu3ge9Pa6d4sve8aDKrvu84tx9gvPe%2F%2FWzwfvFCy67pG1a4s1ndDDPvfKVnfLb%2BmkLMofsdiXv4F%3C%2Fdiagram%3E%3Cdiagram%20name%3D%22Page-4%22%20id%3D%2286p8r_ApIN7auYLh5dO3%22%3E7VvbcuI4EP0aHpnC8gV4HCCbrd1hNhWmNpunlGILWxPb8soimP36lW0JX%2BQMTkK4OVWpQLeFhPqc7lY3dk%2BfBsk1hZE3Jw7ye2DgJD191gNAAwbgL6lmk2tGYJgrXIodMahQLPB%2FSCgHQrvCDoorAxkhPsNRVWmTMEQ2q%2BggpWRdHbYkfnXVCLpIUSxs6KvaO%2Bwwr7aLVP87wq4nV9ascX4lgHKw2EnsQYesSyr9qgesHtAT2NMnvVRX%2FdOnlBC2c5gcHCRT5KfGl3bN1%2F3t7RNs905RyPY058MPps2S6fef3zVw9%2BfdZgD8u7605jP0V8LuwmZsI4HAQYbUJH5CzE4ty6efwDjKQV%2FiBPEVJh4LfC5q%2FG1EcMgy9M1Jz5ylo33shlxh8%2B0gyhVLEjJBOY3jMRFrzHDg8k36%2BJH%2FD2IbIv46hbaHHm6Rg%2BOHG0qclc2%2BxM9utv26lYThnhFlKCmp2lmtsN01IgFidMNlMY1h5lMLb9IMQa51wU1TqLwSLaUXQuEN7nbiV6GZmiMH9M34L%2Fs%2F7v%2B98ac2eXwKB8l6PgLXfU1BGzncC4VIKPOIS0LoXxXaCSWr0Ekxz4hQjPlGSCQY8BMxthH4whUjVX5wtOjmn%2FTzX0wp3mfiGIylYpaIBXJpU5ZuEMXciimTcmWCWWk%2BLt2XrhQzpYKc6EXuxGRFbWGM2z%2FC%2FnwwnYPg76V1NfShHc37AlEGqYtYC99KLbofKlLkQ4afqwGyiVmvWaNY6Sb124Lxw0GF8VtZLpgbSnzoFWyucHq7uwN6QiOqR%2FaEqh%2BYO7ygkVh7Y3PjuOGhuHvYqPgrm5SSYrQJSOiSPoywwpOCBSmkaw8ztIhgZvQ1P5pVEX8hPzVg9%2F6UJU9y0oHHasrSQEPOsgYnjY6uoDMl4RK7K8oJRkJ%2BaYEot%2FAZAVULtVv5zJEyTul0oR0upg5bxlS9QzHV7Gh%2BbcuFUYe4YH1y4Zdc0KwOkUHtQNySFTvn9H0pB62Rgsz5YGLqtSPVQMUEGA2YnDooYwWUeVqZzCYKNrEHo%2FStvfExB4nquxF6zOH89rhVQPvJzUD%2Ba8X4NEjoY9G7Mw8MqwVqsJoqrFYDqqPTBlVWaiVUFx6kTjaNrrYmuKVZFTmlw5rigW3ofxUXAuw4WSJtokA1uR4VUK0doPqJA3rsxqoBqq3Vw7ZV93JaGn1WUSqv1NZUl8K%2FKUOBPGldSPhXW1pdQtUaXSaqx21%2FbYV2ZW5jBthjNB%2B3jOZ5hOtKOD%2BrrtjJUKRTGd9ScoPCmbOpwo1LqcI1tWvVqYwNarheSMZWO16lMlz1u8stw40LKcO73S2rl0vmZbip5GpHUa2XS5eC6nFbZidWLmmtfyscd%2Bgw3HD27XC91JojecDsCkfUZppKmtD5mj6iwKWQpAG9DHfTKWw3Xu%2Bw7o5byKXusHf%2FjmSpJrOMzLr7uf33xXUts7puPWvlZH%2Fvshx9uCnNKh5ZeJPxWptQbOVt35h%2FLv%2FS53yTNTD26pul37vG49qjBIYFPjY8f%2FxdPJ9xofw0whBU15XF%2Bn4Cw8d7SjZ2x3Nl8lsUT%2FTpV%2F8D%3C%2Fdiagram%3E%3Cdiagram%20id%3D%22lw-VR-SbSnkzpTUMKr1w%22%20name%3D%22Page-5%22%3E7VxtU6M6FP41%2FVinkELrR%2Fuid%2Fdq7ao7rveLEyFCXCAsBC37628oCeUl9kVdKXRnnKk5hATOc%2FI8OUnaDhi7i7MA%2BvYFMZHTUXvmogMmHVVV9Z7CPhJLzC1A66UWK8BmalNWhmv8G3GjqBZhE4WFipQQh2K%2FaDSI5yGDFmwwCMhLsdojcYq9%2BtBCFcO1AZ2q9Rab1E6tQ3Wwsv%2BDsGWLnhX9OL3iQlGZv0loQ5O85Exg2lH1jgoWsANGncRW%2FAPjgBC6sZqo7C7GyEm8L%2Fya9nv69gaydw%2BQRz%2BoTW12TLF7Oh1enp7czae35gX4t9vnHqKxcDsyGQq8SAJqE4t40JmurKOARJ6JklZZP6NVnXNCfGZUmPEJURrzkIIRJcxkU9fhV9k7BfEPfv%2BycJcUjjRRnCzyFycxL1Wdwv0Ukigw%2BPM%2F2SNi%2BVgh075zdjuxaTyzun0eCRQGFuL3hl%2Fv7R%2BzmaePri4fZ5Z2bk%2BmXT2tlzgh18N2Pl95%2FgwRF7EnZ%2BUAOZDi52JMQz40rKzeTtCyuhzdNwfDWi89QyfiD1wJjyL4Lzam6NqHS%2Be%2FMCIqAv0qYM8ooGjxMR4WzfCHF3QnXuZlxR3KkNvsHG%2BoghbrB0UakWoFEz92iWeRLvTxGniU%2FYKnX4JnIIFHlcCj7zc6oILOmHiP2IoCNuqJxy5do4C5szlAKb0iUl3ZQGogUu1TunUCtlHoFLU2pdulj1VPc4KZL1Z8UiYUEZKix9QD%2FK4dIrAQh9nr1R292t%2FoLUSv1q7oBeVJSLuiV6%2Bo5BWJaJNUMVO35s5f5FP%2B41qJRfksYhFyl2cWuUNAo5jlJAhgnGvPTxgjfFtrr7KVLvKmuBDTu3HShj66mYB%2FZidg%2BPZeloMy9X%2BTuVmMjO2S%2Fj2jZb2EpwjUHCtnmWch6Rf31U%2FLclCqeeW1DQNz2QxQKgAxv9IiCtDBlsf%2BNxgKTGjBKPE%2BNqBzwi%2B42DSXbC6Ds8jwn4nooLSOc1xFVJcACvYcz5qzz5Wy3uWvfbzMattO4OtLP%2FchHLQWcS4Q5caTbjVNyZFuFaH2ki4AVUibyLrDmlm3rxZ4t7eBd5elOQowc2ISPqlxgWmOw1npLndl1VJS%2BDN50rqF79bztzxJHNQRWFuhKn%2FeBmS%2FewCrWIRr0SrrO8Ohd8jhINyUmw%2BczL8wwxmk6AXGzZmydbWSwGtCzZu%2BfCndfw0jp8HYZHsBTcdGPxA27W%2FLpoeS8651U36oOhjx%2Fa18lIQ29JN%2FI9c5MSjJ51Hn8AE5cxLi5eEKMHkglBJXkmhRUhrSJKIO9tA4O6z42TlWVy9tIck4WCRU%2BznML77Y9PvdzJ3Ap1kcXZzdfyN%2BV6nAWgEUu8ujnqPwJ6KGzX0PQz8F4hEvkgGfB4vvYrCbtVFHm8gy60fiUU4CLGcBI97HBLsWe1MHPyTvGxoQsc8xNGx0f4VMHN7PA2JGBj0Kn63PDoCMxNccUdMkASB4o%2F4AkB4hrQZAGw6oAclWwp6rsBQdUK8IHwE9r8Pd3lGvN3znMoimb70QkhTKLb1D6XtVpV%2FHia0Xerf%2Fnwu%2F%2Fbq5OSVfe9%2FBr5vfFpbwwUXCBpPRq0JvxEyaTRSAzYzwkIbm%2BUNmgMZPaxmwl6nCc3vItUHLEK9whiQIPn4pNeOMDUupgm72FNRqKnxIoOpaEVS1HaBWk%2BdDAnUwaCWo9e4073igSyr1UvHcqNjrtCgv2K%2FT24Hoc6OOEu9LgIADCpDqNvhByUJ5OVayTNNAWRgcNKjlCVy%2FHaAODxrU8gSuJaA26kT%2Bn9ZnyReCXqe3A9FnIVB%2FZ3C7RMiw0RGyrLvhRynENwtWvwcCpv8D%3C%2Fdiagram%3E%3Cdiagram%20id%3D%22qg70R-P7K5_WasmTu0hc%22%20name%3D%22Page-6%22%3E7VzbcqM4EP0aPzoFyFz86EuSSeXmGu%2FWbvZlSgEF2IDlFXJsz9evMMIGhGM7BsQkMy%2BJGnHROerT3ZImHTAKV9cEzr177KCgoynOqgPGHU3TFKPPfsSWdWJR%2B309sbjEd7htZ5j6PxE3Kty68B0U5TpSjAPqz%2FNGG89myKY5GyQEL%2FPdXnCQf%2BscukgwTG0YiNa%2FfId6idXSzJ39G%2FJdL32zmo44hGlnPpLIgw5eZkzgsgNGBGOa%2FBauRiiI0UtxSe672nN1%2B2EEzegxNyx%2BIu11QgKTGGbwdE%2FX9Oa%2Frsq%2FNqLrdMTIYQDwJibUwy6eweByZx0SvJg5KH6swlq7PncYz5lRZcZ%2FEaVrziZcUMxMHg0DfpV9MVn%2FHd9%2F0dP01PDEH7hpjFe51jrbmiDih4gikhpXPk2epvPWU%2BbK7klxI32QiB4HNB5%2BxsCxvEaYvZGsWQeCAkj9t%2Fz8gHyaudt%2B21sn2Gev0BTuE6rOb%2BEe0e0p%2BUdQSFxE%2BV07Ptkvmc%2FYmTYsn8C4qchlPMf2hX6A7700JSi9M87UD%2Bvms2sA5ULJ%2FNNy9Or9Ar0RXhAb1UZvOuw3GCz4kEbjB2b4%2Fud0ejMQuN8xG9O09HyKpnNox1eXTNLzLO5l4w0RilbvwpzCpafKzgEyAW8vd%2FKqpprpZaTVUPZTk0PxZI9QBcgEmPxwEyeG0SuitscnJ4zmSch58VcxhFmo5jHBmy%2FVhx19HPcOfHfGDDYDL5au4QueUe4wKkNsyN8x9kOXjSPwn%2BPRRDZE7OcI2h768R05fvRjQrCzsOlF9OZWxAkwipz0BU70Ekp6Wl2UiAw0KVJd5tEAFJRKNT4Sm%2FbSk%2BjAEZ58UOnMyiPXedyBPQp0O%2FhncPtt%2BsfgoQ0qBHIz3tKlq1DvtwoVOZGtQvpvFUq9%2BbAK9dqlQoZ07rQCd4baq5S7w5SAqinZ3DogBK4zHbjI7M%2BQdTOfXqQ58dWxN1iWWZgQyTe0LSN3b59uDbp01HH4ODUf8cP8CnZVqROxqnorKxSlw9TESVnaz5QlE%2B999XtBN89F%2FblJoT7SeiWZiVUSBrexsXKQxIRuvg7xzMVdOPel53K9Al5mg5lcKVxiIjfCsxffXRA2ofGMXZoiwsYnHTlVyUPXLZtqjUInN%2BFqTCvNI7WyoSWsXtGFtNqWJEuHKTdVax3rqiaHdlAMIDXTbgo6%2BR0vaAt0UTPaFlIsqR6iNuUhJSte5R5i1eIhpxY2hpWfJ8aBsmarqx%2FsDyylMJMyZVBVXinuH0j3R6OAgyW64zYLzGXExThWmT%2BmOXoGpakHidOJ3wjEio8NlOZhEdbhYjh8GwYDfiH0HWfjx2X45n27AojNQtXRFyE2ShAGtQEsuWq%2ByO1Kq7UpXhrrm08Fz6PnpLpZjkoATb5MiJVzRiZEyH45mQAlm7fN6kRPsk607vxKZUmWtPX8cqKlLA2cIexHV3uV57Ln4fxFivGj%2Bam8GD%2BPHrFoHkxumOEaUrSEa%2BlRWDjfoxuyi%2BfUw%2FILstEiaB9YoMljCOVgST4Q2th2lXKsPrdsw0qsPEeBj%2FgKXZa2yIPz%2BNdFGAxsirPJ4x18RsEER%2F5mPwKMnzGlOCzJLikuTHq8oIE%2FQ6PtaeuKEsuuYRyWDdCkI2zH8GXP46iFgqpsJ7Ku8zjllIhVZ4s3IkHJMlWzWq4BuVp%2BAYysnMdnYhTrzAJJN44ukeLGhw5CnXW%2Bofr%2FR3DeHBB3o%2B9jjxkP9wYMe80k3kEEHPaa52Sy3D1vDdB%2BdTdT6DGJFNwecUXT61mHUEvWesrWIazaXE3%2FjDAbeiECSIfZ%2BIwwm2bbYDalBo4T9xs%2FfuL1XcU8rPR6u5Re7ibxiZWbNNKMdpEmbrd%2BBkErLmuUFHONChoQq%2BZPAHMxPPekwyzWzJ8A5mJ4lg%2BzuBLxhcLzsftXqc%2B3ROmB5GL8FyGtqeqZNXd%2FeiE5O7X7Cxbg8n8%3D%3C%2Fdiagram%3E%3C%2Fmxfile%3E)
# Реализация

## Как запустить

Перейти в папку sharding-repl-cache

Запустить команду

```shell
docker compose up --build -d
```

Инициализация конфиг сервера:

```shell
docker exec -it configSrv mongosh --port 27020
rs.initiate(
  {
    _id : "config_server",
       configsvr: true,
    members: [
      { _id : 0, host : "configSrv:27020" }
    ]
  }
);
exit();
```
Инициализация шардов:
```shell
docker exec -it shard1 mongosh --port 27021
rs.initiate(
    {
      _id : "shard1",
      members: [
        { _id : 0, host : "shard1:27021" },
        { _id : 1, host: "mongodb1:27016" },
        { _id : 2, host: "mongodb2:27017" }
      ]
    }
);
exit();
```
```shell
docker exec -it shard2 mongosh --port 27022
rs.initiate(
    {
      _id : "shard2",
      members: [
        { _id : 0, host : "shard2:27022" },
        { _id : 1, host: "mongodb3:27018" },
        { _id : 2, host: "mongodb4:27019" }
      ]
    }
  );
exit();
```
Инициализация роутера и наполнение тестовыми данными:
```shell
docker exec -it mongos_router mongosh --port 27023
sh.addShard( "shard1/shard1:27021");
sh.addShard( "shard2/shard2:27022");
sh.enableSharding("somedb");
sh.shardCollection("somedb.helloDoc", { "name" : "hashed" } )
use somedb

for(var i = 0; i < 1000; i++) db.helloDoc.insert({age:i, name:"ly"+i})

db.helloDoc.countDocuments() 
exit(); 
```
Проверка данных на шардах:
```shell
docker exec -it shard1 mongosh --port 27021
use somedb;
db.helloDoc.countDocuments();
exit(); 
docker exec -it shard2 mongosh --port 27022
use somedb;
db.helloDoc.countDocuments();
exit(); 
```